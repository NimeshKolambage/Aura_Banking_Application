<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer - Aura Bank</title>
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="transfer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <a href="dashboard.html" class="logo"><img src="components/logo.png" alt="Aura Bank Logo"></a>
            <a href="dashboard.html" class="logoname"><img src="components/logoname.png" alt="Aura Bank Logo"></a>
        </div>
        <nav class="navbar">
            <ul class="nav_links">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="login.html"><button class="login-btn"> Log out</button></a></li>
            </ul>
            <div class="three-line-menu">
                <div></div>
                <div></div>
                <div></div>
            </div>
        </nav>
    </header>

    <!-- QR Code Scanner Modal -->
    <div id="transferQRModal" class="qr-modal">
        <div class="qr-modal-content">
            <div class="qr-modal-header">
                <h2>Scan Transfer QR Code</h2>
                <button class="qr-close-btn" id="transferQRClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="qr-modal-body">
                <div id="transferQRReader" class="qr-reader"></div>
                <p class="qr-instructions">Point camera at recipient's QR code</p>
                <button id="transferStartScan" class="btn-scan-start">
                    <i class="fas fa-play"></i>
                    Start Camera
                </button>
                <button id="transferStopScan" class="btn-scan-stop" style="display: none;">
                    <i class="fas fa-stop"></i>
                    Stop Camera
                </button>
            </div>
        </div>
    </div>

    <main>
        <div class="transfer-container">
            <div class="transfer-header">
                <div>
                    <h1><i class="fas fa-exchange-alt"></i> Transfer Money</h1>
                    <p>Move funds between your accounts or to others securely</p>
                </div>
                <div class="transfer-stats">
                    <div class="stat">
                        <span class="label">Daily remaining</span>
                        <span class="value">$8,500</span>
                    </div>
                    <div class="stat">
                        <span class="label">Monthly remaining</span>
                        <span class="value">$35,000</span>
                    </div>
                </div>
            </div>

            <div class="transfer-grid">
                <section class="card form-card">
                    <div class="card-header">
                        <h2>Transfer Details</h2>
                        <span class="badge">Secure</span>
                    </div>

                    <form class="transfer-form">
                        <button type="button" class="btn-scan-qr" id="transferScanQRBtn">
                            <i class="fas fa-qrcode"></i>
                            Scan Recipient QR Code
                        </button>

                        <div class="form-group">
                            <label for="from-account">From Account</label>
                            <select id="from-account" required>
                                <option value="">Select account</option>
                                <option value="savings">Savings - ****1234 ($12,450.50)</option>
                                <option value="checking">Checking - ****5678 ($5,200.00)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="to-account">To</label>
                            <select id="to-account" required>
                                <option value="">Select destination</option>
                                <option value="internal">My Checking - ****5678</option>
                                <option value="mike">Mike Johnson - ****8899</option>
                                <option value="sarah">Sarah Smith - ****4422</option>
                                <option value="new">New recipient</option>
                            </select>
                        </div>

                        <!-- Recipient Details (populated from QR scan) -->
                        <div id="recipientQRInfo" class="recipient-qr-info" style="display: none;">
                            <div class="qr-info-header">
                                <i class="fas fa-check-circle"></i>
                                <span>QR Code Information Loaded</span>
                            </div>
                            <div class="qr-info-details">
                                <div class="info-item">
                                    <span class="label">Recipient Account:</span>
                                    <span class="value" id="qrRecipientAccount">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Recipient Name:</span>
                                    <span class="value" id="qrRecipientName">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="amount">Amount</label>
                                <div class="amount-input">
                                    <span class="currency">$</span>
                                    <input type="number" id="amount" placeholder="0.00" step="0.01" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="transfer-date">Transfer Date</label>
                                <input type="date" id="transfer-date" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="purpose">Purpose</label>
                            <select id="purpose">
                                <option value="">Select purpose</option>
                                <option value="rent">Rent</option>
                                <option value="utilities">Utilities</option>
                                <option value="gift">Gift</option>
                                <option value="savings">Savings transfer</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="notes">Notes (optional)</label>
                            <textarea id="notes" rows="3" placeholder="Add a note for your records"></textarea>
                        </div>

                        <div class="actions-row">
                            <label class="checkbox">
                                <input type="checkbox" id="save-recipient"> Save recipient for future
                            </label>
                            <label class="checkbox">
                                <input type="checkbox" id="recurring"> Make this a recurring transfer
                            </label>
                        </div>

                        <button type="submit" class="submit-btn">
                            <i class="fas fa-paper-plane"></i> Send Transfer
                        </button>
                    </form>
                </section>

                <section class="card side-card">
                    <h3>Recent Transfers</h3>
                    <div class="transfer-list">
                        <div class="transfer-item">
                            <div>
                                <p class="name">To Sarah Smith</p>
                                <p class="meta">Today • Savings → External</p>
                            </div>
                            <span class="amount negative">-$250.00</span>
                        </div>
                        <div class="transfer-item">
                            <div>
                                <p class="name">From Checking</p>
                                <p class="meta">Yesterday • Checking → Savings</p>
                            </div>
                            <span class="amount positive">+$500.00</span>
                        </div>
                        <div class="transfer-item">
                            <div>
                                <p class="name">Paycheck</p>
                                <p class="meta">Dec 12 • Employer → Checking</p>
                            </div>
                            <span class="amount positive">+$2,500.00</span>
                        </div>
                    </div>

                    <h3>Transfer Limits</h3>
                    <div class="limits">
                        <div class="limit-row">
                            <span>Daily limit</span>
                            <span>$10,000</span>
                        </div>
                        <div class="limit-row">
                            <span>Monthly limit</span>
                            <span>$50,000</span>
                        </div>
                        <div class="limit-row">
                            <span>Per transfer</span>
                            <span>$7,500</span>
                        </div>
                        <p class="note">Need higher limits? Contact support to request a temporary increase.</p>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3>Products</h3>
                <ul>
                    <li><a href="#">Personal Banking</a></li>
                    <li><a href="#">Business Accounts</a></li>
                    <li><a href="#">Investment</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Support</h3>
                <ul>
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Security</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>About</h3>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Blog</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2024 Aura Bank. All rights reserved.</p>
        </div>
    </footer>

    <!-- QR Code Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@latest/dist/html5-qrcode.min.js"></script>
    
    <!-- QR Transaction Scanner Utility -->
    <script src="qr-transaction-scanner.js"></script>

    <script>
        // Transfer QR Code Scanner
        const transferQRBtn = document.getElementById('transferScanQRBtn');
        const transferQRModal = document.getElementById('transferQRModal');
        const transferQRClose = document.getElementById('transferQRClose');
        const transferStartScan = document.getElementById('transferStartScan');
        const transferStopScan = document.getElementById('transferStopScan');
        const recipientQRInfo = document.getElementById('recipientQRInfo');
        const toAccountSelect = document.getElementById('to-account');
        const amountInput = document.querySelector('input[id="amount"]');

        let transferQRScanner = null;
        let transferScanning = false;

        // Open QR Modal
        transferQRBtn.addEventListener('click', () => {
            transferQRModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        // Close QR Modal
        transferQRClose.addEventListener('click', closeTransferQR);
        transferQRModal.addEventListener('click', (e) => {
            if (e.target === transferQRModal) {
                closeTransferQR();
            }
        });

        function closeTransferQR() {
            transferQRModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            if (transferScanning) {
                stopTransferScanning();
            }
        }

        // Start Transfer QR Scanning
        transferStartScan.addEventListener('click', async () => {
            transferQRScanner = new Html5Qrcode('transferQRReader');
            try {
                await transferQRScanner.start(
                    { facingMode: 'environment' },
                    { fps: 10, qrbox: 250 },
                    onTransferQRScan,
                    onTransferQRError
                );
                transferScanning = true;
                transferStartScan.style.display = 'none';
                transferStopScan.style.display = 'inline-flex';
            } catch (error) {
                console.error('Camera error:', error);
                alert('Camera access denied');
            }
        });

        // Stop Transfer QR Scanning
        transferStopScan.addEventListener('click', stopTransferScanning);

        async function stopTransferScanning() {
            if (transferQRScanner && transferScanning) {
                try {
                    await transferQRScanner.stop();
                    transferScanning = false;
                    transferStartScan.style.display = 'inline-flex';
                    transferStopScan.style.display = 'none';
                } catch (error) {
                    console.error('Error stopping scanner:', error);
                }
            }
        }

        function onTransferQRScan(decodedText) {
            if (transactionScanner.validateTransactionQR(decodedText)) {
                const qrData = transactionScanner.parseTransferQR(decodedText);
                
                if (qrData) {
                    // Fill transfer form with QR data
                    document.getElementById('qrRecipientAccount').textContent = qrData.recipientAccount;
                    document.getElementById('qrRecipientName').textContent = qrData.recipientName;
                    recipientQRInfo.style.display = 'block';

                    // Pre-fill amount if provided
                    if (qrData.amount && amountInput) {
                        amountInput.value = qrData.amount;
                    }

                    stopTransferScanning();
                    setTimeout(() => {
                        closeTransferQR();
                        alert(`Transfer QR loaded: ${qrData.recipientName}`);
                    }, 500);
                }
            }
        }

        function onTransferQRError(error) {
            console.log('QR Scan error:', error);
        }

        // Original transfer script
    
        const navLinks = document.querySelector('.nav_links');
        const menuToggle = document.querySelector('.three-line-menu');
        const closeMenu = () => { navLinks.classList.remove('nav-active'); menuToggle.classList.remove('active'); }
        menuToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            if (window.innerWidth <= 768) {
                navLinks.classList.toggle('nav-active');
                menuToggle.classList.toggle('active');
            }
        });
        document.querySelectorAll('.nav_links a, .login-btn').forEach(el => el.addEventListener('click', () => {
            if (window.innerWidth <= 768) closeMenu();
        }));
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 && navLinks.classList.contains('nav-active') && !e.target.closest('.nav_links') && !e.target.closest('.three-line-menu')) {
                closeMenu();
            }
        });
        window.addEventListener('resize', () => { if (window.innerWidth > 768) closeMenu(); });
    </script>
</body>
</html>
