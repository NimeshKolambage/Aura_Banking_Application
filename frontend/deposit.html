<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deposit - Aura Bank</title>
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="deposit.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navbar Container -->
    <div id="navbar"></div>

    <!-- QR Code Scanner Modal -->
    <div id="depositQRModal" class="qr-modal">
        <div class="qr-modal-content">
            <div class="qr-modal-header">
                <h2>Scan Deposit QR Code</h2>
                <button class="qr-close-btn" id="depositQRClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="qr-modal-body">
                <div id="depositQRReader" class="qr-reader"></div>
                <p class="qr-instructions">Point camera at sender's QR code</p>
                <button id="depositStartScan" class="btn-scan-start">
                    <i class="fas fa-play"></i>
                    Start Camera
                </button>
                <button id="depositStopScan" class="btn-scan-stop" style="display: none;">
                    <i class="fas fa-stop"></i>
                    Stop Camera
                </button>
            </div>
        </div>
    </div>

    <main>
        <div class="deposit-container">
            <div class="deposit-header">
                <h1><i class="fas fa-piggy-bank"></i> Make a Deposit</h1>
                <p>Deposit funds into your account</p>
            </div>

            <div class="deposit-content">
                <!-- Bank Selection Section -->
                <div class="bank-selection-section" id="bankSelectionSection">
                    <div class="form-card">
                        <h2>Select Deposit Source</h2>
                        <p class="selection-description">Choose where you want to deposit from</p>
                        
                        <div class="bank-options">
                            <div class="bank-option-card" data-bank="aura">
                                <i class="fas fa-building"></i>
                                <h3>Aura Bank</h3>
                                <p>Transfer from your Aura Bank account</p>
                            </div>

                            <div class="bank-option-card" data-bank="other">
                                <i class="fas fa-university"></i>
                                <h3>Other Bank</h3>
                                <p>Transfer from another bank</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other Bank Selection Section -->
                <div class="other-bank-selection-section" id="otherBankSelectionSection" style="display: none;">
                    <div class="form-card">
                        <button class="back-btn" id="backToMainBtn"><i class="fas fa-arrow-left"></i> Back</button>
                        <h2>Select Your Bank</h2>
                        <p class="selection-description">Choose your bank from the list below</p>
                        
                        <div class="bank-list">
                            <div class="bank-list-item" data-bank-id="1">
                                <i class="fas fa-bank"></i>
                                <span>Chase Bank</span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="bank-list-item" data-bank-id="2">
                                <i class="fas fa-bank"></i>
                                <span>Bank of America</span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="bank-list-item" data-bank-id="3">
                                <i class="fas fa-bank"></i>
                                <span>Wells Fargo</span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="bank-list-item" data-bank-id="4">
                                <i class="fas fa-bank"></i>
                                <span>Citibank</span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="bank-list-item" data-bank-id="5">
                                <i class="fas fa-bank"></i>
                                <span>TD Bank</span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="bank-list-item" data-bank-id="6">
                                <i class="fas fa-bank"></i>
                                <span>PNC Bank</span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="deposit-form-section" style="display: none;" id="depositFormSection">
                    <div class="form-card">
                        <button class="back-btn" id="backToSelectionBtn"><i class="fas fa-arrow-left"></i> Back</button>
                        <h2 id="form-title">Deposit Method</h2>
                        <button type="button" class="btn-scan-qr" id="depositScanQRBtn">
                            <i class="fas fa-qrcode"></i>
                            Scan Sender QR Code
                        </button>

                        <!-- Sender Details (populated from QR scan) -->
                        <div id="senderQRInfo" class="sender-qr-info" style="display: none;">
                            <div class="qr-info-header">
                                <i class="fas fa-check-circle"></i>
                                <span>QR Code Information Loaded</span>
                            </div>
                            <div class="qr-info-details">
                                <div class="info-item">
                                    <span class="label">From Bank:</span>
                                    <span class="value" id="qrFromBank">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Amount:</span>
                                    <span class="value" id="qrDepositAmount">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Reference:</span>
                                    <span class="value" id="qrDepositRef">-</span>
                                </div>
                            </div>
                        </div>

                        <form class="deposit-form">
                            <div class="form-group">
                                <label for="deposit-account">Deposit To Account</label>
                                <select id="deposit-account" required>
                                    <option value="">Select Account</option>
                                    <option value="savings">Savings Account - ****1234</option>
                                    <option value="checking">Checking Account - ****5678</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="deposit-amount">Amount</label>
                                <div class="amount-input">
                                    <span class="currency">$</span>
                                    <input type="number" id="deposit-amount" placeholder="0.00" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-group method-specific" id="check-fields" style="display: none;">
                                <label for="check-number">Check Number</label>
                                <input type="text" id="check-number" placeholder="Enter check number">
                            </div>

                            <div class="form-group method-specific" id="transfer-fields" style="display: none;">
                                <label for="from-bank">From Bank Name</label>
                                <input type="text" id="from-bank" placeholder="Enter bank name">
                            </div>

                            <div class="form-group method-specific" id="wire-fields" style="display: none;">
                                <label for="wire-reference">Wire Reference Number</label>
                                <input type="text" id="wire-reference" placeholder="Enter reference number">
                            </div>

                            <div class="form-group">
                                <label for="deposit-date">Deposit Date</label>
                                <input type="date" id="deposit-date" required>
                            </div>

                            <div class="form-group">
                                <label for="notes">Notes (Optional)</label>
                                <textarea id="notes" placeholder="Add any additional information" rows="3"></textarea>
                            </div>

                            <button type="submit" class="submit-btn">
                                <i class="fas fa-plus"></i> Complete Deposit
                            </button>
                        </form>
                    </div>
                </div>

                <div class="deposit-info-section">
                    <div class="info-card deposit-limits">
                        <h3><i class="fas fa-info-circle"></i> Deposit Limits</h3>
                        <div class="limit-item">
                            <span>Daily Limit</span>
                            <span class="limit-value">$10,000</span>
                        </div>
                        <div class="limit-item">
                            <span>Monthly Limit</span>
                            <span class="limit-value">$50,000</span>
                        </div>
                        <div class="limit-item">
                            <span>Check Deposit Limit</span>
                            <span class="limit-value">$5,000 per check</span>
                        </div>
                    </div>

                    <div class="info-card deposit-history">
                        <h3>Recent Deposits</h3>
                        <div class="history-list">
                            <div class="history-item">
                                <div class="history-info">
                                    <p class="history-type">Paycheck Deposit</p>
                                    <p class="history-date">Dec 15, 2024</p>
                                </div>
                                <p class="history-amount">+$2,500.00</p>
                            </div>

                            <div class="history-item">
                                <div class="history-info">
                                    <p class="history-type">Transfer from Chase</p>
                                    <p class="history-date">Dec 10, 2024</p>
                                </div>
                                <p class="history-amount">+$500.00</p>
                            </div>

                            <div class="history-item">
                                <div class="history-info">
                                    <p class="history-type">Check Deposit</p>
                                    <p class="history-date">Dec 5, 2024</p>
                                </div>
                                <p class="history-amount">+$1,200.00</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3>Products</h3>
                <ul>
                    <li><a href="#">Personal Banking</a></li>
                    <li><a href="#">Business Accounts</a></li>
                    <li><a href="#">Investment</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Support</h3>
                <ul>
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Security</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>About</h3>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Blog</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Â© 2024 Aura Bank. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Bank Selection Logic
        const bankSelectionSection = document.getElementById('bankSelectionSection');
        const otherBankSelectionSection = document.getElementById('otherBankSelectionSection');
        const depositFormSection = document.getElementById('depositFormSection');
        const backToMainBtn = document.getElementById('backToMainBtn');
        const backToSelectionBtn = document.getElementById('backToSelectionBtn');
        const bankOptionCards = document.querySelectorAll('.bank-option-card');
        const bankListItems = document.querySelectorAll('.bank-list-item');
        const formTitle = document.getElementById('form-title');
        
        let selectedBank = null;

        // Handle bank option card clicks
        bankOptionCards.forEach(card => {
            card.addEventListener('click', function() {
                const bankType = this.dataset.bank;
                
                if (bankType === 'aura') {
                    selectedBank = 'Aura Bank';
                    bankSelectionSection.style.display = 'none';
                    depositFormSection.style.display = 'block';
                    formTitle.textContent = 'Deposit to Aura Bank';
                    
                    // Show Aura Bank specific form elements
                    const checkFields = document.getElementById('check-fields');
                    if (checkFields) {
                        checkFields.style.display = 'block';
                    }
                } else if (bankType === 'other') {
                    // Show other bank selection
                    bankSelectionSection.style.display = 'none';
                    otherBankSelectionSection.style.display = 'block';
                }
            });
        });

        // Handle bank list item clicks
        bankListItems.forEach(item => {
            item.addEventListener('click', function() {
                // Extract bank name from span element, not the entire textContent
                const bankNameSpan = this.querySelector('span');
                selectedBank = bankNameSpan ? bankNameSpan.textContent.trim() : this.textContent.trim();
                const bankId = this.dataset.bankId;
                
                otherBankSelectionSection.style.display = 'none';
                depositFormSection.style.display = 'block';
                formTitle.textContent = `Deposit to ${selectedBank}`;
                
                // Show other bank specific form elements
                const transferFields = document.getElementById('transfer-fields');
                if (transferFields) {
                    transferFields.style.display = 'block';
                }
                
                // Update form fields with selected bank
                const fromBankInput = document.getElementById('from-bank');
                if (fromBankInput) {
                    fromBankInput.value = selectedBank;
                }
            });
        });

        // Back to main selection button (from other bank list)
        if (backToMainBtn) {
            backToMainBtn.addEventListener('click', () => {
                otherBankSelectionSection.style.display = 'none';
                bankSelectionSection.style.display = 'block';
                selectedBank = null;
            });
        }

        // Back to bank selection button (from form)
        if (backToSelectionBtn) {
            backToSelectionBtn.addEventListener('click', () => {
                depositFormSection.style.display = 'none';
                
                // If we came from Aura Bank, go back to main selection
                if (selectedBank === 'Aura Bank') {
                    bankSelectionSection.style.display = 'block';
                } else {
                    // If we came from other bank, go back to bank list
                    otherBankSelectionSection.style.display = 'block';
                }
                
                // Reset form
                document.querySelectorAll('.method-specific').forEach(field => field.style.display = 'none');
                selectedBank = null;
            });
        }

        // Form submission
        document.querySelector('.deposit-form').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('Deposit request submitted successfully!');
        });

        // Deposit QR Code Scanner
        const depositQRBtn = document.getElementById('depositScanQRBtn');
        const depositQRModal = document.getElementById('depositQRModal');
        const depositQRClose = document.getElementById('depositQRClose');
        const depositStartScan = document.getElementById('depositStartScan');
        const depositStopScan = document.getElementById('depositStopScan');
        const senderQRInfo = document.getElementById('senderQRInfo');
        const depositAmountInput = document.getElementById('deposit-amount');
        const fromBankInput = document.getElementById('from-bank');

        let depositQRScanner = null;
        let depositScanning = false;

        // Open QR Modal
        depositQRBtn.addEventListener('click', () => {
            depositQRModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        // Close QR Modal
        depositQRClose.addEventListener('click', closeDepositQR);
        depositQRModal.addEventListener('click', (e) => {
            if (e.target === depositQRModal) {
                closeDepositQR();
            }
        });

        function closeDepositQR() {
            depositQRModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            if (depositScanning) {
                stopDepositScanning();
            }
        }

        // Start Deposit QR Scanning
        depositStartScan.addEventListener('click', async () => {
            depositQRScanner = new Html5Qrcode('depositQRReader');
            try {
                await depositQRScanner.start(
                    { facingMode: 'environment' },
                    { fps: 10, qrbox: 250 },
                    onDepositQRScan,
                    onDepositQRError
                );
                depositScanning = true;
                depositStartScan.style.display = 'none';
                depositStopScan.style.display = 'inline-flex';
            } catch (error) {
                console.error('Camera error:', error);
                alert('Camera access denied');
            }
        });

        // Stop Deposit QR Scanning
        depositStopScan.addEventListener('click', stopDepositScanning);

        async function stopDepositScanning() {
            if (depositQRScanner && depositScanning) {
                try {
                    await depositQRScanner.stop();
                    depositScanning = false;
                    depositStartScan.style.display = 'inline-flex';
                    depositStopScan.style.display = 'none';
                } catch (error) {
                    console.error('Error stopping scanner:', error);
                }
            }
        }

        function onDepositQRScan(decodedText) {
            if (transactionScanner.validateTransactionQR(decodedText)) {
                const qrData = transactionScanner.parseDepositQR(decodedText);
                
                if (qrData) {
                    // Fill deposit form with QR data
                    document.getElementById('qrFromBank').textContent = qrData.bankCode;
                    document.getElementById('qrDepositAmount').textContent = '$' + qrData.amount;
                    document.getElementById('qrDepositRef').textContent = qrData.reference || 'N/A';
                    senderQRInfo.style.display = 'block';

                    // Pre-fill form fields from QR data
                    if (qrData.amount && depositAmountInput) {
                        depositAmountInput.value = qrData.amount;
                    }
                    if (qrData.bankCode && fromBankInput) {
                        fromBankInput.value = qrData.bankCode;
                    }

                    stopDepositScanning();
                    setTimeout(() => {
                        closeDepositQR();
                        alert(`Deposit QR loaded: $${qrData.amount} from ${qrData.bankCode}`);
                    }, 500);
                }
            }
        }

        function onDepositQRError(error) {
            console.log('QR Scan error:', error);
        }

        // Mobile nav toggle
        const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
        const navbarMenu = document.querySelector('.navbar-menu');
        const navLinks = document.querySelectorAll('.nav-link');

        if (mobileMenuToggle) {
            mobileMenuToggle.addEventListener('click', () => {
                mobileMenuToggle.classList.toggle('active');
                navbarMenu.classList.toggle('active');
            });
        }

        // Close menu when clicking on a link
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                mobileMenuToggle.classList.remove('active');
                navbarMenu.classList.remove('active');
            });
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 && 
                navbarMenu.classList.contains('active') && 
                !e.target.closest('.navbar-menu') && 
                !e.target.closest('.mobile-menu-toggle')) {
                mobileMenuToggle.classList.remove('active');
                navbarMenu.classList.remove('active');
            }
        });

        // Close menu on resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                mobileMenuToggle.classList.remove('active');
                navbarMenu.classList.remove('active');
            }
        });

        // Set active nav item based on current page
        const currentPage = window.location.pathname.split('/').pop();
        navLinks.forEach(link => {
            const href = link.getAttribute('href');
            if (href && href.includes(currentPage)) {
                link.parentElement.classList.add('active');
            }
        });

        window.addEventListener('resize', () => { if (window.innerWidth > 768) closeMenu(); });
    </script>

    <!-- QR Code Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@latest/dist/html5-qrcode.min.js"></script>
    
    <!-- Load Navbar from navbar.html -->
    <script>
        fetch('navbar.html')
            .then(response => response.text())
            .then(html => {
                // Extract the header from navbar.html
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const header = doc.querySelector('header');
                document.getElementById('navbar').appendChild(header);
            })
            .catch(error => console.error('Error loading navbar:', error));
    </script>

    <!-- QR Transaction Scanner Utility -->
    <script src="qr-transaction-scanner.js"></script>
</body>
</html>
